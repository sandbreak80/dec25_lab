# AppDynamics Virtual Appliance - Team Configuration Template
# 
# INSTRUCTIONS:
# 1. Copy this file to team1.cfg, team2.cfg, etc.
# 2. Replace 5 with actual team number (1-5)
# 3. Update TEAM_MEMBERS with actual student names
# 4. Keep all other defaults unless customization needed

# ============================================
# TEAM IDENTITY
# ============================================
5="5"
TEAM_NAME="Team 5"
TEAM_MEMBERS="Student1, Student2, Student3, Student4"
INSTRUCTOR_EMAIL="bmstoner@cisco.com"

# ============================================
# AWS CONFIGURATION
# ============================================
AWS_PROFILE="default"
AWS_REGION="us-west-2"
AWS_ACCOUNT_ID=""  # Will be auto-detected

# ============================================
# NETWORK CONFIGURATION
# ============================================
VPC_NAME="appd-team${5}-vpc"
VPC_CIDR="10.${5}.0.0/16"
SUBNET_NAME="appd-team${5}-subnet-1"
SUBNET_CIDR="10.${5}.0.0/24"
SUBNET_AZ="us-west-2a"

# Second subnet for ALB (different AZ)
SUBNET2_NAME="appd-team${5}-subnet-2"
SUBNET2_CIDR="10.${5}.1.0/24"
SUBNET2_AZ="us-west-2b"

IGW_NAME="appd-team${5}-igw"
RT_NAME="appd-team${5}-rt"
SG_NAME="appd-team${5}-sg"
ALB_SG_NAME="appd-team${5}-alb-sg"

# ============================================
# DNS CONFIGURATION
# ============================================
# Option 1: Subdomain per team (RECOMMENDED)
DNS_DOMAIN="splunkylabs.com"
TEAM_SUBDOMAIN="team${5}"  # Results in: team1.splunkylabs.com
FULL_DOMAIN="${TEAM_SUBDOMAIN}.${DNS_DOMAIN}"

# Shared hosted zone (instructor manages)
HOSTED_ZONE_ID="Z06491142QTF1FNN8O9PR"

# AppDynamics DNS names
TENANT_NAME="customer1"
CONTROLLER_URL="controller-team${5}.${DNS_DOMAIN}"
AUTH_URL="${TENANT_NAME}-team${5}.auth.${DNS_DOMAIN}"
AUTHN_URL="${TENANT_NAME}-tnt-authn-team${5}.${DNS_DOMAIN}"

# ============================================
# S3 CONFIGURATION
# ============================================
# Option 1: Shared bucket for AMI (cost-effective)
SHARED_AMI_BUCKET="appd-lab-shared-ami"

# Option 2: Team-specific bucket
TEAM_BUCKET="appd-team${5}-bucket"

# AMI details
APPD_RAW_IMAGE="appd_va_25.4.0.2016.ami"
APPD_IMAGE_NAME="appd-va-25.4.0.2016-ec2-disk1-team${5}"

# ============================================
# VM CONFIGURATION
# ============================================
VM_TYPE="m5a.4xlarge"  # 16 vCPU, 64 GB RAM
VM_OS_DISK=200         # GB
VM_DATA_DISK=500       # GB

VM_NAME_1="team${5}-vm-1"
VM_NAME_2="team${5}-vm-2"
VM_NAME_3="team${5}-vm-3"

# VM IPs (will be assigned during deployment)
NODE1_IP="10.${5}.0.10"
NODE2_IP="10.${5}.0.11"
NODE3_IP="10.${5}.0.12"

# These will be populated after deployment
NODE1_PUBLIC_IP=""
NODE2_PUBLIC_IP=""
NODE3_PUBLIC_IP=""
INGRESS_IP=""  # ALB DNS name (not an IP)

# ============================================
# LOAD BALANCER CONFIGURATION
# ============================================
ALB_NAME="appd-team${5}-alb"
TARGET_GROUP_NAME="appd-team${5}-tg"

# ACM Certificate
# Option 1: Shared wildcard cert (RECOMMENDED)
SHARED_CERT_ARN="arn:aws:acm:us-west-2:314839308236:certificate/ce4f1e3b-0830-48f2-b187-a26c580637e0"
USE_SHARED_CERT=true

# Option 2: Team-specific wildcard cert
TEAM_CERT_DOMAIN="*.team${5}.${DNS_DOMAIN}"
TEAM_CERT_ARN=""  # Will be populated if team-specific cert is requested

# ============================================
# SECURITY CONFIGURATION
# ============================================
# VM default password (students will change this)
VM_DEFAULT_PASSWORD="changeme"

# Controller admin password (change via UI after installation)
CONTROLLER_ADMIN_PASSWORD="welcome"

# SSH access (restrict to instructor or team IP)
INSTRUCTOR_IP="47.145.5.201/32"  # Update with actual instructor IP
TEAM_IP=""  # Will be detected or manually set

# IP ranges allowed for SSH - Cisco VPN Public Egress IPs
# These are the IPs that AWS sees when VPN users connect
ALLOWED_SSH_CIDRS=(
    "151.186.183.24/32"    # Cisco VPN US-West egress 1
    "151.186.183.87/32"    # Cisco VPN US-West egress 2
    "151.186.182.23/32"    # Cisco VPN US-East egress 1
    "151.186.182.87/32"    # Cisco VPN US-East egress 2
    "151.186.192.0/20"     # Cisco VPN Shared pool (both regions)
)

# ============================================
# RESOURCE TAGGING
# ============================================
TAGS=(
    "Key=Project,Value=AppDynamics-Lab"
    "Key=Team,Value=team${5}"
    "Key=Environment,Value=lab"
    "Key=Owner,Value=${INSTRUCTOR_EMAIL}"
    "Key=AutoShutdown,Value=enabled"
    "Key=CostCenter,Value=Training"
)

# Convert to AWS CLI format
TAG_SPECIFICATIONS="ResourceType=instance,Tags=[${TAGS[*]}]"

# ============================================
# COST CONTROL
# ============================================
# Auto-shutdown schedule (stop VMs when not in use)
AUTO_SHUTDOWN_ENABLED=true
AUTO_SHUTDOWN_TIME="22:00"  # 10 PM UTC (2 PM PST)
AUTO_STARTUP_TIME="14:00"   # 2 PM UTC (6 AM PST)

# ============================================
# LAB PROGRESS TRACKING
# ============================================
# Track which steps have been completed
COMPLETED_STEPS=(
    # Will be populated as students complete each step
    # "01-aws-profile"
    # "02-vpc-created"
    # "03-vms-deployed"
    # "04-alb-configured"
    # "05-dns-setup"
    # "06-cluster-initialized"
    # "07-appd-installed"
)

# ============================================
# TROUBLESHOOTING
# ============================================
# Enable verbose logging
DEBUG_MODE=false

# Save all command output
LOG_DIR="./logs/team${5}"
LOG_FILE="${LOG_DIR}/deployment-$(date +%Y%m%d-%H%M%S).log"

# ============================================
# ADVANCED CONFIGURATION
# ============================================
# IAM role for VM import (shared across all teams)
VM_IMPORT_ROLE="vmimport"

# Deployment mode
DEPLOYMENT_MODE="lab"  # Options: lab, demo, production

# Skip confirmation prompts (for instructor automation)
SKIP_CONFIRMATIONS=false

# Parallel deployment (if deploying multiple teams)
PARALLEL_DEPLOYMENT=false
MAX_PARALLEL_TEAMS=3
