# AppDynamics Virtual Appliance - Team 2 Configuration
# 
# This file contains all configuration for Team 2's isolated lab environment

# ============================================
# TEAM IDENTITY
# ============================================
TEAM_NAME="Team 2"
TEAM_MEMBERS="Student1, Student2, Student3, Student4"
INSTRUCTOR_EMAIL="bmstoner@cisco.com"

# ============================================
# AWS CONFIGURATION
# ============================================
AWS_PROFILE="default"
AWS_REGION="us-west-2"
AWS_ACCOUNT_ID=""  # Will be auto-detected

# ============================================
# NETWORK CONFIGURATION
# ============================================
VPC_NAME="appd-team2-vpc"
VPC_CIDR="10.2.0.0/16"
SUBNET_NAME="appd-team2-subnet-1"
SUBNET_CIDR="10.2.0.0/24"
SUBNET_AZ="us-west-2a"

# Second subnet for ALB (different AZ)
SUBNET2_NAME="appd-team2-subnet-2"
SUBNET2_CIDR="10.2.1.0/24"
SUBNET2_AZ="us-west-2b"

IGW_NAME="appd-team2-igw"
RT_NAME="appd-team2-rt"
SG_NAME="appd-team2-sg"
ALB_SG_NAME="appd-team2-alb-sg"

# ============================================
# DNS CONFIGURATION
# ============================================
# Subdomain per team
DNS_DOMAIN="splunkylabs.com"
TEAM_SUBDOMAIN="team2"
FULL_DOMAIN="team2.splunkylabs.com"

# Shared hosted zone (instructor manages)
HOSTED_ZONE_ID="Z06491142QTF1FNN8O9PR"

# AppDynamics DNS names
TENANT_NAME="customer1"
CONTROLLER_URL="controller-team2.splunkylabs.com"
AUTH_URL="customer1-team2.auth.splunkylabs.com"
AUTHN_URL="customer1-tnt-authn-team2.splunkylabs.com"

# ============================================
# S3 CONFIGURATION
# ============================================
# Shared bucket for AMI (cost-effective)
SHARED_AMI_BUCKET="appd-lab-shared-ami"

# Team-specific bucket
TEAM_BUCKET="appd-team2-bucket"

# AMI details
APPD_RAW_IMAGE="appd_va_25.4.0.2016.ami"
APPD_IMAGE_NAME="appd-va-25.4.0.2016-ec2-disk1-team2"

# ============================================
# VM CONFIGURATION
# ============================================
VM_TYPE="m5a.4xlarge"  # 16 vCPU, 64 GB RAM
VM_OS_DISK=200         # GB
VM_DATA_DISK=500       # GB

VM_NAME_1="team2-vm-1"
VM_NAME_2="team2-vm-2"
VM_NAME_3="team2-vm-3"

# VM IPs (will be assigned during deployment)
NODE1_IP="10.2.0.10"
NODE2_IP="10.2.0.11"
NODE3_IP="10.2.0.12"

# These will be populated after deployment
NODE1_PUBLIC_IP=""
NODE2_PUBLIC_IP=""
NODE3_PUBLIC_IP=""

# ============================================
# LOAD BALANCER CONFIGURATION
# ============================================
ALB_NAME="appd-team2-alb"
TARGET_GROUP_NAME="appd-team2-tg"

# ACM Certificate - Using shared wildcard cert
CERT_DOMAIN="*.splunkylabs.com"
CERT_ARN="arn:aws:acm:us-west-2:314839308236:certificate/e4c4ea3e-bb4b-47fb-8e49-ad61e479f64f"
USE_SHARED_CERT=true

# Team-specific wildcard cert (if needed)
TEAM_CERT_DOMAIN="*.team2.splunkylabs.com"
TEAM_CERT_ARN=""

# ============================================
# SECURITY CONFIGURATION
# ============================================
# Cisco VPN Egress IPs (public IPs that VPN users appear from)
ALLOWED_SSH_CIDRS=(
    "151.186.183.24/32"  # Cisco VPN US-West egress 1
    "151.186.183.87/32"  # Cisco VPN US-West egress 2  
    "151.186.182.23/32"  # Cisco VPN US-East egress 1
    "151.186.182.87/32"  # Cisco VPN US-East egress 2
    "151.186.192.0/20"   # Cisco VPN Shared pool
)

# Security group rules for VMs
VM_INGRESS_RULES=(
    "22|tcp|SSH from Cisco VPN"
    "443|tcp|HTTPS from ALB"
    "8443|tcp|AppDynamics Admin from ALB"
)

# Security group rules for ALB
ALB_INGRESS_RULES=(
    "443|tcp|0.0.0.0/0|HTTPS from anywhere"
    "80|tcp|0.0.0.0/0|HTTP redirect to HTTPS"
)

# ============================================
# APPDYNAMICS CONFIGURATION
# ============================================
# Controller settings
CONTROLLER_ADMIN_USER="admin"
CONTROLLER_ADMIN_PASS="welcome"  # Change after first login!

# License key (if available)
APPD_LICENSE_KEY=""  # Will be prompted during installation

# Services to install
INSTALL_AIOPS=false
INSTALL_OTIS=false
INSTALL_ATD=false
INSTALL_UIL=false
INSTALL_SECUREAPP=false

# Deployment size
DEPLOYMENT_SIZE="small"  # small, medium, large

# ============================================
# RESOURCE TAGS
# ============================================
TAGS=(
    "Key=Project,Value=AppDynamics-Lab"
    "Key=Team,Value=team2"
    "Key=Environment,Value=lab"
    "Key=Owner,Value=${INSTRUCTOR_EMAIL}"
    "Key=AutoShutdown,Value=enabled"
    "Key=CostCenter,Value=Training"
)

# ============================================
# OPERATIONAL SETTINGS
# ============================================
# Backup and snapshot settings
ENABLE_BACKUPS=false
BACKUP_RETENTION_DAYS=7

# Monitoring and alerting
ENABLE_CLOUDWATCH=true
CLOUDWATCH_LOG_RETENTION=7  # days

# Auto-shutdown schedule (optional)
AUTO_SHUTDOWN_ENABLED=true
AUTO_SHUTDOWN_TIME="20:00"  # UTC
AUTO_START_TIME="08:00"     # UTC

# ============================================
# DEPLOYMENT OPTIONS
# ============================================
# Deployment behavior
SKIP_CONFIRMATION=false
VERBOSE_OUTPUT=false
DEBUG_MODE=false

# Save all command output
LOG_DIR="./logs/team2"
LOG_FILE="${LOG_DIR}/deployment-$(date +%Y%m%d-%H%M%S).log"

# ============================================
# ADVANCED CONFIGURATION
# ============================================
# These should rarely need changing

# Timeouts (seconds)
VM_READY_TIMEOUT=300
BOOTSTRAP_TIMEOUT=900
CLUSTER_INIT_TIMEOUT=600
INSTALL_TIMEOUT=1800

# Health check settings
HEALTH_CHECK_INTERVAL=30
HEALTH_CHECK_HEALTHY_THRESHOLD=2
HEALTH_CHECK_UNHEALTHY_THRESHOLD=3
HEALTH_CHECK_TIMEOUT=10
HEALTH_CHECK_PROTOCOL="HTTPS"
HEALTH_CHECK_PATH="/controller/auth"
HEALTH_CHECK_MATCHER="200,301,302,405"

# Instance details
INSTANCE_PROFILE=""  # Optional IAM instance profile
ENABLE_DETAILED_MONITORING=false
ENABLE_TERMINATION_PROTECTION=false

# Network settings
ENABLE_DNS_HOSTNAMES=true
ENABLE_DNS_SUPPORT=true
ENABLE_IPV6=false

# ============================================
# END OF CONFIGURATION
# ============================================
